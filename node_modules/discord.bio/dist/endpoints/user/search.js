"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
/*
The search endpoint is an unlisted endpoint.
Normally,we are not allowed to use it according to the TOS.
I are allowed to add it to this pacakge according to this message from the owner.
https://discordapp.com/channels/661331961188712459/693649305105334272/712271223395975170
(it is in offical discord.bio server)
*/
const discord_js_1 = require("discord.js");
const User_1 = __importDefault(require("../../structures/User"));
const DBioAPIError_1 = __importDefault(require("../../structures/DBioAPIError"));
async function search(query) {
    const result = await this.bio.api('/user/search/' + query, 'GET')
        .catch((error) => {
        if (error instanceof DBioAPIError_1.default && error.message === 'No users found with this query.') {
            return { success: true, payload: [] };
        }
        else
            throw error;
    });
    let profiles = result.payload.map((profile) => {
        profile.discord = new User_1.default(profile.discord);
        profile.user.verified = Boolean(profile.user.verified);
        profile.user.premium = Boolean(profile.user.premium);
        return profile;
    });
    profiles = new discord_js_1.Collection(result.payload.map((entry) => [entry.discord.id, entry]));
    return profiles;
}
module.exports = search;
//# sourceMappingURL=search.js.map